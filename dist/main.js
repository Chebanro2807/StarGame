(()=>{"use strict";class t{constructor(t,e){this.sprite=new PIXI.Sprite.from(t),this.speed=e,this.dead=!1}moveUp(){this.sprite.y-=this.speed}moveDown(){this.sprite.y+=this.speed}moveLeft(){this.sprite.x-=this.speed}moveRight(){this.sprite.x+=this.speed}move(t){switch(t){case"up":this.moveUp();break;case"right":this.moveRight();break;case"down":this.moveDown();break;case"left":this.moveLeft()}}isDead(){return this.dead}checkCollision(t){if(void 0===t)return console.log("collision's got undefined object"),!1;let e=this.sprite.getBounds(),i=t.sprite.getBounds();return e.x+e.width>i.x&&e.x<i.x+i.width&&e.y+e.height>i.y&&e.y<i.y+i.height}}class e extends t{constructor(...t){if(super("image/bullet.png",10),1===t.length&&t[0]instanceof PIXI.Sprite){let e=t[0];this.sprite.anchor.set(.5,1),this.sprite.width=4,this.sprite.height=10,this.sprite.x=e.x+this.sprite.width/2,this.sprite.y=e.y-e.height}}}class i extends t{constructor(...t){super("image/planet.png",t[0]),this.sprite.width=50,this.sprite.height=50,this.sprite.anchor.set(.5),this.sprite.x=t[0]/2,this.sprite.y=0}}class s extends t{constructor(...t){super("image/starShip.png",10),1===t.length&&t[0]instanceof HTMLCanvasElement&&(this.sprite.anchor.set(.5,1),this.sprite.x=t[0].width/2,this.sprite.y=t[0].height)}}class h{create(t,...h){switch(t){case"bullet":return new e(...h);case"planet":return new i(...h);case"starShip":return new s(...h)}}}new class{constructor(){this.factory=new h,this.bullets=[],this.fireRate=0,this.planets=[],this.lvl=2,this.timeOut=3e3,this.starShipLoopAction=[],this.gameContainer=document.querySelector("#gameContainer"),this.app=new PIXI.Application({width:window.innerWidth,height:window.innerHeight,backgroundColor:11184810}),this.gameContainer.appendChild(this.app.view),this.starShip=this.decoratedFactory("starShip",this.app.view),this.app.ticker.add(this.gameLoop.bind(this)),this.app.stage.interactive=!0,window.addEventListener("keydown",(t=>this.containPressCheck(this.eventDistributor(t)))),window.addEventListener("keyup",(t=>this.containUnPressCheck(this.eventDistributor(t)))),setInterval(this.planetsCreate.bind(this),this.timeOut)}getRandom(t,e){return Math.floor(Math.random()*(e-t)+t)}planetsCreate(){let t=this.decoratedFactory("planet",this.setPlanetSpeedByLevel());t.sprite.x=this.getRandom(0+t.sprite.width,window.innerWidth-t.sprite.width),this.planets.push(t)}pictDecorator(t){return null===t?console.log("попали в нулл"):this.app.stage.addChild(t.sprite),t}decoratedFactory(t,...e){return"starShip"!==t||null==this.starShip||this.starShip.isDead()?this.pictDecorator(this.factory.create(t,...e)):(console.log("We have one!"),this.starShip)}containPressCheck(t){-1===this.starShipLoopAction.indexOf(t)&&this.starShipLoopAction.push(t)}containUnPressCheck(t){let e=this.starShipLoopAction.indexOf(t);-1!==e&&this.starShipLoopAction.splice(e,1)}eventDistributor(t){switch(t.keyCode){case 32:return"fire";case 37:return"left";case 39:return"right"}}fireBullet(){this.bullets.push(this.decoratedFactory("bullet",this.starShip.sprite))}updateObject(t,e){for(let i=t.length-1;i>-1;i--)t[i].move(e),this.checkBorders(t[i],e),this.checkDeath(t,i)}checkBorders(t,e){switch(e){case"up":t.sprite.position.y<0&&(t.dead=!0);break;case"right":t.sprite.position.x>window.innerWidth-this.starShip.sprite.width/2&&t.moveLeft();break;case"down":t.sprite.position.y>window.innerHeight-this.starShip.sprite.height-t.sprite.height/2-11&&(t.dead=!0);break;case"left":t.sprite.position.x<0+this.starShip.sprite.width/2&&t.moveRight()}}checkDeath(t,e){t[e].isDead()&&(this.app.stage.removeChild(t[e].sprite),t.splice(e,1))}updateStarShipLocation(){for(let t=0;t<this.starShipLoopAction.length;t++)switch(this.starShipLoopAction[t]){case"fire":0===this.fireRate&&this.fireBullet(),this.fireRate=7==++this.fireRate?0:this.fireRate;break;case"left":this.starShip.moveLeft(),this.checkBorders(this.starShip,"left");break;case"right":this.starShip.moveRight(),this.checkBorders(this.starShip,"right")}}updatePlanetSpeed(){for(let t=0;t<this.planets.length;t++)this.planets[t].speed=this.setPlanetSpeedByLevel()}setPlanetSpeedByLevel(){return.5*this.lvl}gameLoop(){this.updateObject(this.bullets,"up"),this.updateObject(this.planets,"down");for(let t=0;t<this.bullets.length;t++)for(let e=0;e<this.planets.length;e++)this.planets[e].checkCollision(this.bullets[t])&&(this.bullets[t].dead=!0,this.planets[e].dead=!0);this.updateStarShipLocation()}}})();