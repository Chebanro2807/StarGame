(()=>{"use strict";class t{constructor(t,e){this.sprite=new PIXI.Sprite.from(t),this.speed=e,this.dead=!1}moveUp(){this.sprite.y-=this.speed}moveDown(){this.sprite.y+=this.speed}moveLeft(){this.sprite.x-=this.speed}moveRight(){this.sprite.x+=this.speed}move(t){switch(t){case"up":this.moveUp();break;case"right":this.moveRight();break;case"down":this.moveDown();break;case"left":this.moveLeft()}}isDead(){return this.dead}checkCollision(t){let e=this.sprite.getBounds(),s=t.sprite.getBounds();return e.x+e.width>s.x&&e.x<s.x+s.width&&e.y+e.height>s.y&&e.y<s.y+s.height}}class e extends t{constructor(...t){if(super("image/bullet.png",10),1===t.length&&t[0]instanceof PIXI.Sprite){let e=t[0];this.sprite.anchor.set(.5,1),this.sprite.width=4,this.sprite.x=e.x+this.sprite.width/2,this.sprite.y=e.y-e.height}}}class s extends t{constructor(...t){super("image/planet.png",.5),1===t.length&&(this.sprite.anchor.set(.5),this.sprite.x=t[0]/2,this.sprite.y=0)}}class i extends t{constructor(...t){super("image/starShip.png",10),1===t.length&&t[0]instanceof HTMLCanvasElement&&(this.sprite.anchor.set(.5,1),this.sprite.x=t[0].width/2,this.sprite.y=t[0].height)}}class h{create(t,...h){switch(t){case"bullet":return new e(...h);case"planet":return new s(...h);case"starShip":return new i(...h)}}}new class{constructor(){this.factory=new h,this.bullets=[],this.planets=[],this.starShipLoopAction=[],this.gameContainer=document.querySelector("#gameContainer"),this.app=new PIXI.Application({width:window.innerWidth,height:window.innerHeight,backgroundColor:11184810}),this.gameContainer.appendChild(this.app.view),this.starShip=this.decoratedFactory("starShip",this.app.view),this.app.ticker.add(this.gameLoop.bind(this)),this.app.stage.interactive=!0,window.addEventListener("keydown",this.moveShip.bind(this)),window.addEventListener("keyup",this.moveCheker.bind(this)),this.planets.push(this.decoratedFactory("planet",this.app.view.width))}pictDecorator(t){return null===t?console.log("попали в нулл"):this.app.stage.addChild(t.sprite),t}decoratedFactory(t,...e){return this.pictDecorator(this.factory.create(t,...e))}moveShip(t){switch(t.keyCode){case 32:this.containPressCheck("fire");break;case 37:this.containPressCheck("left");break;case 39:this.containPressCheck("right")}}containPressCheck(t){console.log(this.starShipLoopAction.indexOf(t)),-1===this.starShipLoopAction.indexOf(t)&&this.starShipLoopAction.push(t)}containUnPressCheck(t){this.starShipLoopAction.filter((e=>e===t)).length>0&&this.starShipLoopAction.splice(this.starShipLoopAction.findIndex((e=>e===t)),this.starShipLoopAction.filter((e=>e===t)).length)}moveCheker(t){switch(console.log(this.starShipLoopAction),t.keyCode){case 32:this.containUnPressCheck("fire");break;case 37:this.containUnPressCheck("left");break;case 39:this.containUnPressCheck("right")}}fireBullet(){this.bullets.push(this.decoratedFactory("bullet",this.starShip.sprite))}updateObject(t,e){for(let s=0;s<t.length;s++)t[s].move(e),t[s].sprite.position.y<0&&(t[s].dead=!0),this.checkDeath(t,s)}checkDeath(t,e){t[e].isDead()&&(this.app.stage.removeChild(t[e].sprite),t.splice(e,1))}gameLoop(){this.updateObject(this.bullets,"up"),this.updateObject(this.planets,"down");for(let t=0;t<this.bullets.length;t++)for(let e=0;e<this.planets.length;e++)this.planets[e].checkCollision(this.bullets[t])&&(this.bullets[t].dead=!0,this.planets[e].dead=!0,this.checkDeath(this.bullets,t),this.checkDeath(this.planets,e));for(let t=0;t<this.starShipLoopAction.length;t++)switch(this.starShipLoopAction[t]){case"fire":this.fireBullet();break;case"left":this.starShip.moveLeft();break;case"right":this.starShip.moveRight()}}}})();